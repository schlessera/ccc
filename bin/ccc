#!/usr/bin/env bash

# Claude Code Central - Development Runner
# This script runs the development version of CCC from the source directory

# Get the directory where this script is located
# Resolve symlinks to get the actual script location
SCRIPT_PATH="${BASH_SOURCE[0]}"
while [ -h "$SCRIPT_PATH" ]; do
    SCRIPT_DIR="$( cd "$( dirname "$SCRIPT_PATH" )" && pwd )"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    [[ $SCRIPT_PATH != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$( cd "$( dirname "$SCRIPT_PATH" )" && pwd )"
PROJECT_DIR="$( cd "$SCRIPT_DIR/.." && pwd )"

# Check if node_modules exists
if [ ! -d "$PROJECT_DIR/node_modules" ]; then
    echo "⚠️  Dependencies not installed. Running npm install..."
    cd "$PROJECT_DIR" && npm install
fi

# Check if dist directory exists
if [ ! -d "$PROJECT_DIR/dist" ]; then
    echo "⚠️  Project not built. Running npm run build..."
    cd "$PROJECT_DIR" && npm run build
fi

# Run the CLI with all passed arguments
exec node "$PROJECT_DIR/dist/cli/index.js" "$@"